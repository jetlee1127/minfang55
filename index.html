<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>可可冒險島指南 - 手機版模擬</title>
    <style>
        /* --- CSS 樣式 --- */
        :root {
            --discord-bg-darkest: #1e1f22; /* 手機版更深的背景 */
            --discord-bg-dark: #282b30;   /* 頻道列表、底部導航背景 */
            --discord-bg-medium: #36393f; /* 主要內容區背景 */
            --discord-bg-light: #40444b;  /* 輸入框、活動頻道背景 */
            --discord-header: #282b30;    /* 頂部標題欄背景 */
            --discord-text-primary: #dcddde;
            --discord-text-secondary: #b9bbbe;
            --discord-text-muted: #72767d;
            --discord-text-link: #00aff4; /* 手機版連結藍色 */
            --discord-channel-text: #8e9297;
            --discord-active-text: #ffffff;
            --discord-active-icon: var(--accent-color1);
            --discord-scrollbar-thumb: #202225;
            --discord-scrollbar-track: #2e3338;
            --highlight-green: #43b581;
            --accent-color1: #d4a373;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; /* 移除移動端點擊高亮 */
        }

        html, body {
            height: 100%; /* 確保 body 和 html 佔滿視窗高度 */
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Whitney', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            background-color: var(--discord-bg-medium); /* 主體背景用中等暗色 */
            color: var(--discord-text-primary);
            display: flex;
            flex-direction: column; /* 主體垂直佈局 */
            font-size: 15px; /* 手機基礎字體 */
            overflow: hidden; /* 防止 body 滾動 */
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        /* --- 頂部標題欄 --- */
        .top-header {
            background-color: var(--discord-header);
            color: var(--discord-text-primary);
            padding: 0 15px;
            height: 50px;
            display: flex;
            align-items: center;
            font-size: 1.1em;
            font-weight: 600;
            box-shadow: 0 1px 0 rgba(0,0,0,0.2);
            flex-shrink: 0; /* 不壓縮 */
            z-index: 10; /* 確保在頂層 */
        }
        .top-header-icon {
            margin-right: 10px;
            font-size: 1.2em;
            color: var(--discord-text-muted);
        }
        .top-header-title {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }


        /* --- 子頻道/章節列表 (在主內容區頂部) --- */
        .sub-channel-nav {
            background-color: var(--discord-bg-dark);
            padding: 8px 10px;
            overflow-x: auto; /* 允許橫向滾動 */
            white-space: nowrap; /* 防止換行 */
            display: flex; /* 改為 flex 以便橫向排列 */
            flex-shrink: 0;
            border-bottom: 1px solid var(--discord-bg-darkest);
            scrollbar-width: none; /* 隱藏滾動條 (Firefox) */
            -ms-overflow-style: none;  /* 隱藏滾動條 (IE and Edge) */
        }
        .sub-channel-nav::-webkit-scrollbar { display: none; /* 隱藏滾動條 (Chrome, Safari, Opera) */ }

        .sub-channel-item {
            display: inline-block; /* 保持橫向排列但允許 padding */
            padding: 8px 15px;
            margin-right: 8px;
            border-radius: 20px; /* 藥丸形狀 */
            background-color: var(--discord-bg-light);
            color: var(--discord-channel-text);
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }
        .sub-channel-item:hover {
            background-color: #4f545c; /* 稍亮一點的 hover */
            color: var(--discord-text-primary);
        }
        .sub-channel-item.active {
            background-color: var(--accent-color1); /* 主題高亮色 */
            color: white;
            font-weight: bold;
        }
        .sub-channel-item.completed {
            opacity: 0.7; /* 已完成的稍微暗淡 */
        }
         .sub-channel-item.completed:after {
            content: " ✓"; /* 完成的小勾 */
            color: var(--highlight-green);
            font-size: 0.8em;
            margin-left: 4px;
         }


        /* --- 主內容區 --- */
        .main-content {
            flex-grow: 1; /* 佔據剩餘垂直空間 */
            background-color: var(--discord-bg-medium);
            overflow-y: auto; /* 允許內容垂直滾動 */
            padding: 15px;
            scrollbar-width: thin;
            scrollbar-color: var(--discord-scrollbar-thumb) var(--discord-scrollbar-track);
        }
        .content-section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--discord-bg-dark);
            border-radius: 8px; /* 內容卡片圓角 */
        }
        .content-section h3 {
            color: var(--discord-text-primary);
            font-size: 1.25em;
            margin-top: 0;
            margin-bottom: 12px;
            border-bottom: 1px solid var(--discord-bg-light);
            padding-bottom: 8px;
        }
        .content-section h3.channel-title { font-size: 1.15em; font-weight: 500; }
        .content-section h3.channel-title:before { content: "# "; color: var(--discord-text-muted); font-weight: bold; margin-right: 4px;}
        .content-section p, .content-section li {
            color: var(--discord-text-secondary);
            margin-bottom: 8px;
            font-size: 0.95em; /* 內容文字大小 */
            line-height: 1.6;
        }
         .content-section ul, .content-section ol { padding-left: 20px; }
        .content-section strong.highlight { color: var(--accent-color1); font-weight: bold; }
        .content-section .important-note { color: #faa61a; font-weight: bold; }
        .content-section .architect-warning { display: block; margin-top: 8px; color: #faa61a; font-weight: bold; }

        /* 模擬聊天訊息 */
        .message-group { margin-bottom: 15px; }
        .message { display: flex; align-items: flex-start; padding: 2px 0; }
        .message-avatar {
            width: 36px; height: 36px; margin-right: 10px; font-size: 1em;
            border-radius: 50%; background-color: var(--accent-color1);
            flex-shrink: 0; display:flex; align-items:center; justify-content:center;
            font-weight:bold; color:white;
        }
        .message-avatar.kua { background-color: #7289da; }
        .message-content { flex-grow: 1; }
        .message-header { display: flex; align-items: baseline; margin-bottom: 3px; }
        .message-username { font-weight: 500; color: var(--discord-text-primary); margin-right: 6px; font-size: 1em;}
        .message-username.kua { color: #9099dd; }
        .message-timestamp { font-size: 0.7em; color: var(--discord-text-muted); }
        .message-text { color: var(--discord-text-primary); line-height: 1.4rem; font-size:1em;}
        .message-text p { margin-bottom: 4px !important; }

        /* --- 底部導航欄 --- */
        .bottom-nav {
            background-color: var(--discord-bg-dark);
            border-top: 1px solid var(--discord-bg-darkest);
            display: flex;
            height: 55px; /* 底部導航高度 */
            flex-shrink: 0; /* 不壓縮 */
            box-shadow: 0 -1px 0 rgba(0,0,0,0.2);
        }
        .nav-item {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--discord-text-muted);
            cursor: pointer;
            transition: color 0.2s;
            padding: 4px 0;
        }
        .nav-item:hover {
            color: var(--discord-text-secondary);
        }
        .nav-item.active {
            color: var(--discord-active-icon); /* 選中時圖標顏色 */
        }
        .nav-icon {
            font-size: 1.5em; /* 圖標大小 */
            margin-bottom: 2px;
        }
        .nav-label {
            font-size: 0.7em; /* 標籤文字大小 */
            font-weight: 500;
        }
        .nav-item.active .nav-label { /* 選中時標籤文字顏色 */
            color: var(--discord-text-primary);
        }


        .completion-toast {
            /* ... (樣式與之前相同) ... */
        }
         @keyframes slideUpFadeOut {
            /* ... (樣式與之前相同) ... */
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="top-header">
            <span id="topHeaderIcon" class="top-header-icon">🏝️</span>
            <span id="topHeaderTitle" class="top-header-title">可可冒險島指南</span>
        </header>

        <nav id="subChannelNav" class="sub-channel-nav">
            <!-- 子頻道/章節標題將由 JavaScript 生成 -->
        </nav>

        <main id="mainContent" class="main-content">
            <!-- 主要內容將由 JavaScript 生成 -->
        </main>

        <nav class="bottom-nav">
            <div class="nav-item" data-server-id="guide">
                <div class="nav-icon">🏝️</div>
                <div class="nav-label">島嶼指南</div>
            </div>
            <div class="nav-item" data-server-id="brio">
                <div class="nav-icon">👨‍🍳</div>
                <div class="nav-label">與布里歐</div>
            </div>
            <!-- 可以添加更多底部導航項，例如模擬提及、用戶設置等，但目前只實現主要內容切換 -->
        </nav>
    </div>

    <div id="completionToast" class="completion-toast">
        所有內容已探索完畢！你真是個學習高手！🎉
    </div>

    <script>
        // --- JavaScript 腳本 ---
        const mainGuideTopics = [ // 主指南的章節/子頻道
            { id: 'welcome', icon: '👋', name: '開始探索', headerTitle: "歡迎來到可可冒險島", content: `...` /* 省略內容以保持簡潔，請從之前版本複製 */ },
            { id: 'discord_connection', icon: '🖥️', name: 'Discord連接', headerTitle: "Discord 連接教學", content: `...` },
            { id: 'facilities_worldtree', icon: '🌳', name: '世界樹', headerTitle: "核心設施 - 世界樹", content: `...` },
            { id: 'facilities_others', icon: '📋', name: '其他設施', headerTitle: "核心設施 - 其他", content: `...` },
            { id: 'covenant_rules', icon: '📜', name: '約定與須知', headerTitle: "島嶼生活準則", content: `...` }, // 合併約定和須知到一個 "頻道"
            { id: 'manager_words', icon: '💖', name: '管理員的話', headerTitle: "島嶼的溫度與祝福", content: `...` },
        ];
        // (guideTopics 的 content 內容請參考上一個 HTML 版本的 JavaScript 部分，為了縮短代碼，這裡省略了詳細內容)
        // !! 請務必將上一個版本 JavaScript 中的 guideTopics 每個 content 的內容複製到這裡對應的 id !!
        // 例如：
        mainGuideTopics.find(t => t.id === 'welcome').content = `
            <div class="content-section">
                <h3>系統精靈的歡迎</h3>
                <p>系統精靈：「再次歡迎你，小甜點！很高興能成為你的嚮導。」</p>
                <p>「這個指南模擬器將帶你熟悉可可冒險島 Discord 伺服器的重要資訊。點擊<strong class="highlight">底部導航</strong>可以切換查看主指南內容或與布里歐大師的對話。在主指南中，點擊<strong class="highlight">上方的章節標籤</strong>，就可以查看對應的內容了。」</p>
                <p>「準備好了嗎？讓我們開始探索<strong class="highlight">可可冒險島指南</strong>吧！」</p>
            </div>
        `;
        mainGuideTopics.find(t => t.id === 'discord_connection').content = `
            <div class="content-section">
                <h3 class="channel-title">Discord 環境建置</h3>
                <p>系統精靈：「要加入我們的島嶼，首先你需要 Discord！它就像我們的魔法通訊水晶。」</p>
                <p>取得方式:</p>
                <ul>
                    <li><strong>IOS 設備:</strong> 前往 App Store 搜尋「Discord」。</li>
                    <li><strong>安卓設備:</strong> 前往 Play 商店搜尋「Discord」。</li>
                    <li><strong>PC/Mac:</strong> 前往 discord.com 下載或使用網頁版。</li>
                </ul>
            </div>
            <div class="content-section">
                <h3 class="channel-title">Discord 系統操作</h3>
                <p>系統精靈：「熟悉界面很重要哦！」</p>
                <ul>
                    <li><strong class="highlight">導覽 - 左側:</strong> 點擊伺服器列表旁的箭頭可看見頻道列表。</li>
                    <li><strong class="highlight">導覽 - 右側:</strong> 系統設定、通知、搜尋等。成員上線狀態也會顯示。</li>
                    <li><strong class="highlight">訊息操作 - 左下角 (+):</strong> 新增投票、上傳圖片/檔案 (有大小限制)。</li>
                    <li><strong class="highlight">訊息操作 - 左下角第二個圖標:</strong> 傳送指令 (島上有三位員工可幫忙)。</li>
                    <li><strong class="highlight">聊天室類型:</strong> 文字頻道 (#) 無法語音，可投票傳圖文；語音頻道 (🔊) 點擊即進入，可分享畫面，調整他人音量/禁音 (僅對自己有效)。</li>
                    <li><strong class="highlight">公開性:</strong> 分為「公開」(無鎖)和「私人」(上鎖，需權限/身份組)。</li>
                </ul>
            </div>
        `;
        mainGuideTopics.find(t => t.id === 'facilities_worldtree').content = `
            <div class="content-section">
                <h3 class="channel-title">烘焙大廳</h3>
                <p>系統精靈：「這是你初次抵達的溫馨房間，系統會在這裡歡迎你！」</p>
            </div>
            <div class="content-section">
                <h3 class="channel-title">世界樹-天氣中心</h3>
                <p>這裡的天氣和<strong class="highlight">現實世界</strong>同步哦！有天氣預報、預警等功能 (但警報太吵，訊息通知已被管理員關掉了)。</p>
            </div>
            <div class="content-section">
                <h3 class="channel-title">世界樹-資訊中心</h3>
                <p>所有重要的<strong class="highlight">系統消息</strong>都會在這裡公告。</p>
            </div>
        `;
        mainGuideTopics.find(t => t.id === 'facilities_others').content = `
            <div class="content-section">
                <h3 class="channel-title">可可冒險島事務中心</h3>
                <ul>
                    <li><strong>許願池:</strong> 用來許願，不定時會有抽獎 (若沒有經費它就是個池塘 😉)。</li>
                    <li><strong>能量統計:</strong> 在營隊期間，會用來關心大家的餐食狀態。</li>
                </ul>
            </div>
            <div class="content-section">
                <h3 class="channel-title">甜點嘰嘰喳喳</h3>
                <p>自由交談的空間，有許多文字聊天室 (#) 和語音聊天室 (🔊)。有些冠有特定股名稱的房間，則只有該股的成員才能看到和進入。</p>
            </div>
             <div class="content-section">
                <h3 class="channel-title">調查員聚集地 & 小甜點聚落</h3>
                <p>系統精靈：「這是你和管理員之間的<strong class="highlight">秘密通訊頻道</strong>！」</p>
                <ul>
                    <li><strong>隱私第一:</strong> <strong class="highlight">只有你自己能看到和進入</strong>專屬空間。需身份認證開通。</li>
                    <li><strong>重要訊息:</strong> 空間內有三則重要訊息 (包含<strong class="highlight">小甜點夥伴</strong>及匿名聊天連結)。</li>
                    <li><span class="important-note">絕對保密事項:</span> Discord 中<strong class="highlight">黑色背景標示</strong>的內容 (匿名烘焙坊號碼(Line)、預設小甜點名、您的小甜點) <strong class="highlight">嚴禁外洩</strong>！</li>
                    <li><strong>員工機器人 & 商品:</strong> 可使用員工2指令購物 (需先加值)。<p class="architect-warning important-note">給甜點建築師的提醒: 使用「送禮物」功能時，對方會直接收到通知，所以請不要用這個功能來給你負責的小甜點送禮哦！</p></li>
                </ul>
            </div>
        `;
        mainGuideTopics.find(t => t.id === 'covenant_rules').content = `
             <div class="content-section">
                <h3>可可冒險島約定 - 核心精神</h3>
                <p>系統精靈：「約定在可可曆1000年頒布，是島嶼的基石。核心理念是：<strong class="highlight">建立一個包容與尊重個體的社會</strong>。」</p>
                <h3 class="channel-title">第一章：立約緣由</h3>
                <ul>
                    <li>每一個甜點生而獨特，應被<strong class="highlight">尊重</strong>。</li>
                    <li>甜點之間的相異是世界的甜美，<strong class="highlight">非缺陷</strong>。</li>
                    <li>甜點建築師的責任是幫助甜點<strong class="highlight">發掘價值</strong>，而非改變本質。</li>
                </ul>
                <h3 class="channel-title">第二章：甜點基本權利</h3>
                 <p>包含：存在的權利、選擇的自由、個性的尊重、公平對待、甜點建築師的責任。</p>
                <h3 class="channel-title">第三章：烘焙坊與社會責任</h3>
                 <p>甜點建築師應遵守四大守則：1. 不強迫改變本質，2. 不評判價值，3. 耐心傾聽，4. 幫助找到位置。</p>
                <h3 class="channel-title">第四章：約定的延續與修訂</h4>
                 <p>修訂需召開「糖霜會議」。結語強調世界的美好在於無數風味的交織。</p>
            </div>
            <div class="content-section">
                <h3>可可冒險島須知 (超級重要!)</h3>
                <p>系統精靈：「這些是島上的黃金守則，請務必牢記！」</p>
                <ol>
                    <li>各個小甜點與甜點建築師登入可可冒險島後，管理員會逐步登入各甜點的身份組，當身份組確定後，各位將能夠見到各自、各組別的私人房間；若登入後各房間尚未顯現，請稍待。</li>
                    <li>在各自私人的聊天室中（Discord），已有三則訊息，分為歡迎訊息、您的小甜點公布與匿名聊天室連結、甜點建築師匿名聊天室連結；請對於Discord顯示為<strong class="highlight">黑色</strong>的部份保密，<strong class="highlight">勿透露給他人</strong>，包含「匿名烘焙坊的號碼（Line）」、「預設小甜點的名稱」、「您的小甜點」；顯示為黑色的部分點擊後即可顯現。</li>
                    <li>進入可可冒險島（Discord）後，請將暱稱改為<strong class="highlight">本名</strong>。</li>
                    <li>進入「匿名烘焙坊（Line）」請以<strong class="highlight">預設的暱稱進入</strong>；或由「形容詞＋甜點名」組合成的暱稱進入，若暱稱選擇自訂，則需要將新的名稱提供給管理員。</li>
                    <li>可可冒險島的各個空間都有各自的功能，同時對於小甜點與甜點建築師都會有著不同的權限設定，關於空間的功能可至第貳章：可可冒險島查看。</li>
                    <li>可可冒險島的商品系統，將在密籌時開啟，將由統一商品或特別指定執行；屆時您可以先加值現金至系統中（將錢交給管理員協助儲值），並選擇商品，管理員將代為送出，另成功送出後會傳送明細，明細會在個人的訊息傳送。</li>
                    <li>「建築師」由於法規，需要有建築師證照才能稱建築師，為保護各位不會這麼容易被告，建議各位<strong class="highlight">不要簡稱「建築師」喔～</strong></li>
                    <li>可可冒險島共有三位員工，但他們不時會罷工，当他們罷工時，可以等一些時間再和他們互動。</li>
                    <li>甜點建築師的存在旨在<strong class="highlight">協助小甜點自由開展</strong>，並成為小甜點的支持。</li>
                </ol>
            </div>
        `;
        mainGuideTopics.find(t => t.id === 'manager_words').content =  `
            <div class="content-section">
                <h3>管理員的祝福與期盼</h3>
                <p>系統精靈：「小甜點，你已經完成了大部分的探索，做得非常棒！現在，請聽聽島嶼管理員們想對你說的話，這是他們對所有新成員的溫暖期盼。」</p>
                <p>可可冒險島上，有許多可愛的小甜點與細心呵護他們的甜點建築師。他們共同維持著這座島嶼的甜美氛圍，讓糖霜雲飄蕩在天空，巧克力河流緩緩流淌，構築出一個充滿香氣與溫暖的世界。</p>
                <p>然而，隨著島嶼發展，新的挑戰逐漸浮現——有些小甜點在成長過程中迷失了方向，不確定自己的未來；有些甜點建築師承擔了過多責任，無法兼顧小甜點的需求；甚至島上的三位愛罷工的員工，時常因為種種理由停下手邊工作，使得烘焙坊的運作增添不少困難與變數。</p>
                <p>面對這些挑戰，管理員期待建立一個<strong class="highlight">支持網路</strong>，讓甜點建築師、小甜點們，以及島上的所有居民都能互相扶持，確保每個甜點都能夠找到自己的價值與歸屬。這個支持網路不僅將提供協助與指引，也致力創造更和諧的環境，讓島嶼的甜美氣息得以延續，讓每位小甜點都能自由開展，在故事中綻放光彩。</p>
            </div>
        `;

        // 初始化 isCompleted 狀態，確保每個 topic 都有
        mainGuideTopics.forEach(topic => {
            if (typeof topic.isCompleted === 'undefined') {
                topic.isCompleted = false;
            }
        });


        const brioDialogueContent = { // 布里歐的內容
            id: 'brio_main_dialogue',
            icon: '👨‍🍳',
            name: '與布里歐的記事記錄',
            headerTitle: '與布里歐的對話',
            content: `
                <div class="message-group">
                    <div class="message">
                        <div class="message-avatar">布</div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-username">布里歐</span>
                                <span class="message-timestamp">可可曆 某年某月某日 - 關於《青春》</span>
                            </div>
                            <div class="message-text">
                                <p>「歲月悠悠，衰微只及肌膚，熱忱拋卻，頹廢必至靈魂。」<br>——塞繆爾·厄爾曼《青春》</p>
                                <p>垮垮垮鬆，是這就是再說你，不只皮膚鬆鬆的，還頹廢到了靈魂。</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="message-group">
                    <div class="message">
                        <div class="message-avatar kua">垮</div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-username kua">垮垮垮鬆</span>
                                <span class="message-timestamp">片刻之後</span>
                            </div>
                            <div class="message-text">
                                <p>在啦，幹。</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="message-group">
                    <div class="message">
                        <div class="message-avatar">布</div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-username">布里歐</span>
                                <span class="message-timestamp">可可曆 另一年某月某日 - 關於《看不見的城市》</span>
                            </div>
                            <div class="message-text">
                                <p>「生靈的地獄，不是一個即將來臨的地方；如果真有一個地獄，它已經就在這兒存在了，那是我們每天生活其間的地獄，是我們聚在一起而形成的地獄。」<br>——卡爾維諾《看不見的城市》</p>
                                <p>你能夠想像一堆甜點聚在一起嗎？那簡直是個天堂。</p>
                            </div>
                        </div>
                    </div>
                </div>
                 <div class="message-group">
                    <div class="message">
                        <div class="message-avatar">布</div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-username">布里歐</span>
                                <span class="message-timestamp">可可曆 近期 - 關於奶龍</span>
                            </div>
                            <div class="message-text">
                                <p>奶龍就是沒有腮紅、耳朵及閃電形狀尾巴的皮卡丘。</p>
                                <p><em style="color:var(--discord-text-muted); font-size:0.9em;">(精靈画外音：這就是著名的奶龍傳說由來！XD)</em></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="content-section" style="background-color:var(--discord-bg-medium); border: 1px solid var(--discord-bg-light);">
                     <h3>關於布里歐的更多故事 (歷史片段)</h3>
                     <p>在可可曆127年，島上就有了這位傳奇的甜點建築師——布里歐 (Brio)。他不只是製作甜點，更是小甜點們的守護者。他用奶油般溫暖的雙手，為每個即將誕生的甜點灌注靈魂，輕聲對它們說：「歡迎來到世界，你準備好探索自己的甜美人生了嗎？」</p>
                     <p>布里歐深知每個甜點的獨特。他曾對焦慮的草莓泡芙說：「你不需要變得酥脆，柔軟也是一種可愛的特質。」他也鼓勵膽怯的可可可頌（也就是我們剛剛提到的『垮垮垮鬆』！）：『你經過層層折疊，才有了現在的樣子，不會這麼容易垮掉的。』他的信念是幫助甜點發掘自己的價值，而非改變它們。</p>
                </div>
            `,
            isCompleted: false
        };


        document.addEventListener('DOMContentLoaded', () => {
            const topHeaderIconEl = document.getElementById('topHeaderIcon');
            const topHeaderTitleEl = document.getElementById('topHeaderTitle');
            const subChannelNavEl = document.getElementById('subChannelNav');
            const mainContentEl = document.getElementById('mainContent');
            const bottomNavItems = document.querySelectorAll('.nav-item');
            const completionToastEl = document.getElementById('completionToast');

            let activeServerId = 'guide'; // 'guide' 或 'brio'
            let activeSubChannelId = mainGuideTopics[0].id; // 對於主指南，這是預設的子頻道ID

            // 更新頂部標題欄
            function updateTopHeader(icon, title) {
                if(topHeaderIconEl) topHeaderIconEl.textContent = icon;
                if(topHeaderTitleEl) topHeaderTitleEl.textContent = title;
            }

            // 渲染子頻道/章節導航 (僅當 activeServerId === 'guide')
            function renderSubChannels() {
                if (!subChannelNavEl) return;
                subChannelNavEl.innerHTML = ''; // 清空
                subChannelNavEl.style.display = (activeServerId === 'guide') ? 'flex' : 'none'; // 控制顯示

                if (activeServerId === 'guide') {
                    mainGuideTopics.forEach(topic => {
                        const item = document.createElement('div');
                        item.classList.add('sub-channel-item');
                        item.dataset.id = topic.id;
                        item.textContent = topic.name; // 使用 topic.name 作為標籤
                        if (topic.id === activeSubChannelId) {
                            item.classList.add('active');
                        }
                        if (topic.isCompleted) {
                            item.classList.add('completed');
                        }
                        item.addEventListener('click', () => selectSubChannel(topic.id));
                        subChannelNavEl.appendChild(item);
                    });
                }
            }

            // 選擇底部導航的 "伺服器"
            function selectServer(serverId) {
                if (activeServerId === serverId && serverId !== 'guide') return; // 如果已是布里歐，且再次點擊，不重複加載
                activeServerId = serverId;

                bottomNavItems.forEach(item => {
                    item.classList.toggle('active', item.dataset.serverId === serverId);
                });

                if (activeServerId === 'guide') {
                    const firstTopic = mainGuideTopics[0];
                    activeSubChannelId = firstTopic.id;
                    updateTopHeader(firstTopic.icon || '🏝️', firstTopic.headerTitle || firstTopic.name);
                    renderSubChannels();
                    loadContent(firstTopic);
                } else if (activeServerId === 'brio') {
                    activeSubChannelId = brioDialogueContent.id; // 布里歐只有一個內容
                    updateTopHeader(brioDialogueContent.icon || '👨‍🍳', brioDialogueContent.headerTitle || brioDialogueContent.name);
                    renderSubChannels(); // 會隱藏子頻道導航
                    loadContent(brioDialogueContent);
                }
            }

            // 選擇子頻道/章節 (僅當 activeServerId === 'guide')
            function selectSubChannel(subChannelId) {
                if (activeServerId !== 'guide' || activeSubChannelId === subChannelId) return;
                activeSubChannelId = subChannelId;
                const selectedTopic = mainGuideTopics.find(t => t.id === subChannelId);
                if (selectedTopic) {
                    updateTopHeader(selectedTopic.icon || '🏝️', selectedTopic.headerTitle || selectedTopic.name);
                    loadContent(selectedTopic);
                    renderSubChannels(); // 更新 active 和 completed 狀態
                }
            }

            // 加載內容到主區域
            function loadContent(itemData) {
                if (!mainContentEl || !itemData) return;
                mainContentEl.innerHTML = itemData.content;
                mainContentEl.scrollTop = 0; // 滾動到頂部

                if (!itemData.isCompleted) {
                    itemData.isCompleted = true;
                    checkAllCompleted();
                }
            }

            // 檢查是否所有內容都已完成
            function checkAllCompleted() {
                const allGuideDone = mainGuideTopics.every(topic => topic.isCompleted);
                const brioDone = brioDialogueContent.isCompleted;
                if (allGuideDone && brioDone && completionToastEl) {
                    if (completionToastEl.style.display !== 'block') {
                        completionToastEl.style.display = 'block';
                        completionToastEl.style.animation = 'none';
                        completionToastEl.offsetHeight; /* trigger reflow */
                        completionToastEl.style.animation = '';
                        setTimeout(() => {
                            completionToastEl.style.display = 'none';
                        }, 3500);
                    }
                }
            }

            // 為底部導航項添加事件監聽
            bottomNavItems.forEach(item => {
                item.addEventListener('click', () => {
                    selectServer(item.dataset.serverId);
                });
            });

            // 初始化
            if (topHeaderIconEl && topHeaderTitleEl && subChannelNavEl && mainContentEl && completionToastEl) {
                selectServer(activeServerId); // 初始加載預設 "伺服器" 和內容
            } else {
                console.error("一個或多個必要的 DOM 元素未找到，遊戲無法初始化。");
            }
        });
    </script>
</body>
</html>
